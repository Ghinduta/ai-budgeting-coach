# Story 01.03: Create .NET Solution and Project Files

**Epic:** Epic 1 - Foundation Setup
**Story ID:** STORY-01-03
**Priority:** P0 (Blocking)
**Estimated:** 4 hours

---

## Status

**Draft**

---

## Story

**As a** .NET developer,
**I want** the .NET solution file and all C# project files created with proper references and dependencies,
**so that** I can build and develop all microservices with consistent Clean Architecture structure and dependency management.

---

## Acceptance Criteria

1. `BudgetCoach.sln` created at root level
2. All service project files (.csproj) created with .NET 8 target framework
3. Project references configured correctly (API → Core, Infrastructure → Core)
4. Shared.Contracts.csproj and Shared.Common.csproj created
5. All projects compile successfully with `dotnet build`
6. Solution structure visible in Visual Studio/Rider
7. NuGet packages specified for each project type
8. All projects use consistent SDK and language version (C# 12)

---

## Tasks / Subtasks

- [ ] Create .NET solution file (AC: 1)
  - [ ] Run `dotnet new sln -n BudgetCoach` at repository root
  - [ ] Verify BudgetCoach.sln created successfully

- [ ] Create ApiGateway project (AC: 2, 6, 7, 8)
  - [ ] Navigate to services/ApiGateway/
  - [ ] Run `dotnet new webapi -n ApiGateway.API --framework net8.0`
  - [ ] Add project to solution: `dotnet sln add services/ApiGateway/ApiGateway.API/ApiGateway.API.csproj`
  - [ ] Add required NuGet packages (Yarp.ReverseProxy, Serilog.AspNetCore)

- [ ] Create UserService projects (AC: 2, 3, 6, 7, 8)
  - [ ] Create UserService.API: `dotnet new webapi -n UserService.API --framework net8.0`
  - [ ] Create UserService.Core: `dotnet new classlib -n UserService.Core --framework net8.0`
  - [ ] Create UserService.Infrastructure: `dotnet new classlib -n UserService.Infrastructure --framework net8.0`
  - [ ] Add all 3 projects to solution
  - [ ] Add project references: API → Core, Infrastructure → Core
  - [ ] Add NuGet packages to each layer

- [ ] Create TransactionService projects (AC: 2, 3, 6, 7, 8)
  - [ ] Create TransactionService.API: `dotnet new webapi -n TransactionService.API --framework net8.0`
  - [ ] Create TransactionService.Core: `dotnet new classlib -n TransactionService.Core --framework net8.0`
  - [ ] Create TransactionService.Infrastructure: `dotnet new classlib -n TransactionService.Infrastructure --framework net8.0`
  - [ ] Add all 3 projects to solution
  - [ ] Add project references: API → Core, Infrastructure → Core
  - [ ] Add NuGet packages to each layer

- [ ] Create AIService projects (AC: 2, 3, 6, 7, 8)
  - [ ] Create AIService.API: `dotnet new webapi -n AIService.API --framework net8.0`
  - [ ] Create AIService.Core: `dotnet new classlib -n AIService.Core --framework net8.0`
  - [ ] Create AIService.Infrastructure: `dotnet new classlib -n AIService.Infrastructure --framework net8.0`
  - [ ] Add all 3 projects to solution
  - [ ] Add project references: API → Core, Infrastructure → Core
  - [ ] Add NuGet packages to each layer

- [ ] Create BudgetService projects (AC: 2, 3, 6, 7, 8)
  - [ ] Create BudgetService.API: `dotnet new webapi -n BudgetService.API --framework net8.0`
  - [ ] Create BudgetService.Core: `dotnet new classlib -n BudgetService.Core --framework net8.0`
  - [ ] Create BudgetService.Infrastructure: `dotnet new classlib -n BudgetService.Infrastructure --framework net8.0`
  - [ ] Add all 3 projects to solution
  - [ ] Add project references: API → Core, Infrastructure → Core
  - [ ] Add NuGet packages to each layer

- [ ] Create NotificationService projects (AC: 2, 3, 6, 7, 8)
  - [ ] Create NotificationService.API: `dotnet new webapi -n NotificationService.API --framework net8.0`
  - [ ] Create NotificationService.Core: `dotnet new classlib -n NotificationService.Core --framework net8.0`
  - [ ] Create NotificationService.Infrastructure: `dotnet new classlib -n NotificationService.Infrastructure --framework net8.0`
  - [ ] Add all 3 projects to solution
  - [ ] Add project references: API → Core, Infrastructure → Core
  - [ ] Add NuGet packages to each layer

- [ ] Create shared projects (AC: 4, 6, 8)
  - [ ] Create BudgetCoach.Contracts: `dotnet new classlib -n BudgetCoach.Contracts --framework net8.0`
  - [ ] Create BudgetCoach.Common: `dotnet new classlib -n BudgetCoach.Common --framework net8.0`
  - [ ] Add both projects to solution
  - [ ] No external dependencies for these projects initially

- [ ] Configure project references (AC: 3)
  - [ ] For each service, add Core reference to API project
  - [ ] For each service, add Core reference to Infrastructure project
  - [ ] Verify dependency direction is correct (no circular references)

- [ ] Build and verify (AC: 5, 6)
  - [ ] Run `dotnet restore BudgetCoach.sln`
  - [ ] Run `dotnet build BudgetCoach.sln`
  - [ ] Verify all projects build successfully (0 errors)
  - [ ] Open solution in IDE to verify structure

---

## Dev Notes

### Architecture Reference

- **Primary Source:** `docs/architecture/tech-stack.md` Section 2 (Backend Technology Stack)
- **Source Tree:** `docs/architecture/source-tree.md` Section 3.1 (Common Service Structure)

### Target Framework

All projects MUST target **.NET 8.0 LTS**
```xml
<TargetFramework>net8.0</TargetFramework>
<LangVersion>12.0</LangVersion>
<Nullable>enable</Nullable>
```

### NuGet Packages by Project Type

**API Projects** (all [ServiceName].API projects):
```xml
<PackageReference Include="Microsoft.AspNetCore.OpenApi" Version="8.0.*" />
<PackageReference Include="Swashbuckle.AspNetCore" Version="6.5.*" />
<PackageReference Include="Serilog.AspNetCore" Version="8.0.*" />
<PackageReference Include="FluentValidation.AspNetCore" Version="11.3.*" />
```

**Core Projects** (all [ServiceName].Core projects):
```xml
<!-- NO external dependencies - Pure domain logic -->
<!-- Only .NET 8 framework reference -->
```

**Infrastructure Projects** (all [ServiceName].Infrastructure projects):
```xml
<PackageReference Include="Microsoft.EntityFrameworkCore" Version="8.0.*" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Design" Version="8.0.*" />
<PackageReference Include="Npgsql.EntityFrameworkCore.PostgreSQL" Version="8.0.*" />
<PackageReference Include="MassTransit" Version="8.2.*" />
<PackageReference Include="MassTransit.RabbitMQ" Version="8.2.*" />
```

**ApiGateway.API** (special case):
```xml
<PackageReference Include="Yarp.ReverseProxy" Version="2.1.*" />
<PackageReference Include="Serilog.AspNetCore" Version="8.0.*" />
<PackageReference Include="Microsoft.AspNetCore.Authentication.JwtBearer" Version="8.0.*" />
```

**Shared Projects**:
```xml
<!-- No external dependencies initially -->
<!-- Will add as needed -->
```

### Project Reference Commands

For each service (example: UserService):
```bash
# API → Core reference
dotnet add services/UserService/UserService.API/UserService.API.csproj reference services/UserService/UserService.Core/UserService.Core.csproj

# Infrastructure → Core reference
dotnet add services/UserService/UserService.Infrastructure/UserService.Infrastructure.csproj reference services/UserService/UserService.Core/UserService.Core.csproj
```

### Clean Architecture Dependency Rules

**CRITICAL - Dependency Direction:**
```
API Layer ──────→ Core Layer ←────── Infrastructure Layer
                      ↑
                (No dependencies)
```

- ✅ **API** can reference **Core**
- ✅ **Infrastructure** can reference **Core**
- ❌ **Core** MUST NOT reference **API** or **Infrastructure**
- ❌ **API** MUST NOT reference **Infrastructure** directly

### Solution Folder Structure

When opened in IDE, solution should show:
```
BudgetCoach.sln
├─ services
│  ├─ ApiGateway
│  │  └─ ApiGateway.API
│  ├─ UserService
│  │  ├─ UserService.API
│  │  ├─ UserService.Core
│  │  └─ UserService.Infrastructure
│  ├─ TransactionService
│  │  ├─ TransactionService.API
│  │  ├─ TransactionService.Core
│  │  └─ TransactionService.Infrastructure
│  ├─ AIService
│  │  ├─ AIService.API
│  │  ├─ AIService.Core
│  │  └─ AIService.Infrastructure
│  ├─ BudgetService
│  │  ├─ BudgetService.API
│  │  ├─ BudgetService.Core
│  │  └─ BudgetService.Infrastructure
│  └─ NotificationService
│     ├─ NotificationService.API
│     ├─ NotificationService.Core
│     └─ NotificationService.Infrastructure
└─ shared
   ├─ BudgetCoach.Contracts
   └─ BudgetCoach.Common
```

### Common PropertyGroup Settings

All .csproj files should include:
```xml
<PropertyGroup>
  <TargetFramework>net8.0</TargetFramework>
  <Nullable>enable</Nullable>
  <ImplicitUsings>enable</ImplicitUsings>
  <LangVersion>12.0</LangVersion>
  <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
</PropertyGroup>
```

### Build Order

Solution should build in this order (automatically handled by dependencies):
1. Shared projects (BudgetCoach.Contracts, BudgetCoach.Common)
2. All [ServiceName].Core projects
3. All [ServiceName].Infrastructure and [ServiceName].API projects
4. ApiGateway.API

### Testing

#### Testing Standards

**Test Location:** No unit tests required for this story (just project scaffolding)

**Build Verification:**
```bash
# Restore dependencies
dotnet restore BudgetCoach.sln

# Build all projects
dotnet build BudgetCoach.sln --no-restore

# Expected output:
# Build succeeded.
#     0 Warning(s)
#     0 Error(s)
```

**IDE Verification:**
- Open BudgetCoach.sln in Visual Studio 2022, Rider, or VS Code
- Verify all projects visible in Solution Explorer
- Verify folder structure matches expected layout
- Verify no build errors in IDE

**Dependency Verification:**
```bash
# Check project references
dotnet list BudgetCoach.sln reference

# Should show:
# API projects reference Core
# Infrastructure projects reference Core
# No circular references
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-06 | 1.0 | Initial story creation from epic | Winston (Architect) |

---

## Dev Agent Record

### Agent Model Used

_[To be filled by dev agent]_

### Debug Log References

_[To be filled by dev agent]_

### Completion Notes List

_[To be filled by dev agent]_

### File List

_[To be filled by dev agent]_

---

## QA Results

_[To be filled by QA agent after implementation]_
