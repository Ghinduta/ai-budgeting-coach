# Story 01.06: Create Development Scripts

**Epic:** Epic 1 - Foundation Setup
**Story ID:** STORY-01-06
**Priority:** P2 (Medium)
**Estimated:** 2 hours

---

## Status

**Draft**

---

## Story

**As a** developer,
**I want** utility scripts that simplify common development tasks like starting infrastructure and running migrations,
**so that** I can quickly set up my development environment and perform routine tasks with simple commands.

---

## Acceptance Criteria

1. `infrastructure/scripts/setup-dev.sh` created (starts Docker services)
2. `infrastructure/scripts/setup-dev.ps1` created (Windows PowerShell version)
3. `infrastructure/scripts/run-migrations.sh` created (placeholder)
4. `infrastructure/scripts/seed-data.sh` created (placeholder)
5. All scripts have executable permissions
6. Scripts include helpful output messages
7. README documents how to use each script

---

## Tasks / Subtasks

- [ ] Create setup-dev.sh script (AC: 1, 5, 6)
  - [ ] Create `infrastructure/scripts/setup-dev.sh`
  - [ ] Add shebang: `#!/bin/bash`
  - [ ] Add `set -e` for error handling
  - [ ] Check if Docker is running
  - [ ] Navigate to infrastructure directory
  - [ ] Run `docker-compose up -d`
  - [ ] Wait for services to be healthy
  - [ ] Print service access URLs
  - [ ] Add helpful error messages
  - [ ] Make script executable: `chmod +x`

- [ ] Create setup-dev.ps1 script (AC: 2, 6)
  - [ ] Create `infrastructure/scripts/setup-dev.ps1`
  - [ ] Add PowerShell error handling
  - [ ] Check if Docker Desktop is running
  - [ ] Navigate to infrastructure directory
  - [ ] Run `docker-compose up -d`
  - [ ] Wait for services to be healthy
  - [ ] Print service access URLs
  - [ ] Add helpful error messages

- [ ] Create run-migrations.sh script (AC: 3, 5, 6)
  - [ ] Create `infrastructure/scripts/run-migrations.sh`
  - [ ] Add placeholder for EF Core migrations
  - [ ] Add comments explaining future usage
  - [ ] Print "Not yet implemented" message
  - [ ] Make script executable: `chmod +x`

- [ ] Create seed-data.sh script (AC: 4, 5, 6)
  - [ ] Create `infrastructure/scripts/seed-data.sh`
  - [ ] Add placeholder for data seeding
  - [ ] Add comments explaining future usage
  - [ ] Print "Not yet implemented" message
  - [ ] Make script executable: `chmod +x`

- [ ] Create scripts README (AC: 7)
  - [ ] Create `infrastructure/scripts/README.md`
  - [ ] Document purpose of each script
  - [ ] Add usage examples
  - [ ] Add prerequisites section
  - [ ] Add troubleshooting tips

- [ ] Test scripts on clean environment (AC: 1, 2, 5, 6)
  - [ ] Test setup-dev.sh on macOS/Linux
  - [ ] Test setup-dev.ps1 on Windows
  - [ ] Verify error handling works
  - [ ] Verify helpful messages display
  - [ ] Verify services start correctly

---

## Dev Notes

### Architecture Reference

- **Implementation Plan:** `docs/implementation-plan.md` Section 2, Phase 0
- **Source Tree:** `docs/architecture/source-tree.md` Section 6 (Infrastructure Structure)

### setup-dev.sh Template

```bash
#!/bin/bash
set -e

echo "üöÄ Starting AI Budgeting Coach development environment..."
echo ""

# Check if Docker is running
if ! docker info > /dev/null 2>&1; then
    echo "‚ùå Error: Docker is not running"
    echo "Please start Docker Desktop and try again"
    exit 1
fi

# Navigate to docker directory
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd "$SCRIPT_DIR/../docker" || exit 1

# Start Docker Compose services
echo "üì¶ Starting infrastructure services..."
docker-compose up -d

# Wait for services to be healthy
echo "‚è≥ Waiting for services to be healthy..."
sleep 10

# Check service status
echo ""
echo "üìä Service Status:"
docker-compose ps

echo ""
echo "‚úÖ Development environment ready!"
echo ""
echo "üîó Service URLs:"
echo "  PostgreSQL:   localhost:5432 (user: budgetcoach, password: budgetcoach)"
echo "  RabbitMQ UI:  http://localhost:15672 (user: guest, password: guest)"
echo "  Prometheus:   http://localhost:9090"
echo "  Grafana:      http://localhost:3000 (user: admin, password: admin)"
echo ""
echo "üí° To stop services: cd infrastructure/docker && docker-compose down"
```

### setup-dev.ps1 Template

```powershell
# AI Budgeting Coach Development Environment Setup (Windows)

Write-Host "üöÄ Starting AI Budgeting Coach development environment..." -ForegroundColor Cyan
Write-Host ""

# Check if Docker is running
try {
    docker info | Out-Null
} catch {
    Write-Host "‚ùå Error: Docker is not running" -ForegroundColor Red
    Write-Host "Please start Docker Desktop and try again" -ForegroundColor Yellow
    exit 1
}

# Navigate to docker directory
$scriptPath = Split-Path -Parent $MyInvocation.MyCommand.Path
Set-Location "$scriptPath\..\docker"

# Start Docker Compose services
Write-Host "üì¶ Starting infrastructure services..." -ForegroundColor Cyan
docker-compose up -d

# Wait for services to be healthy
Write-Host "‚è≥ Waiting for services to be healthy..." -ForegroundColor Yellow
Start-Sleep -Seconds 10

# Check service status
Write-Host ""
Write-Host "üìä Service Status:" -ForegroundColor Cyan
docker-compose ps

Write-Host ""
Write-Host "‚úÖ Development environment ready!" -ForegroundColor Green
Write-Host ""
Write-Host "üîó Service URLs:" -ForegroundColor Cyan
Write-Host "  PostgreSQL:   localhost:5432 (user: budgetcoach, password: budgetcoach)"
Write-Host "  RabbitMQ UI:  http://localhost:15672 (user: guest, password: guest)"
Write-Host "  Prometheus:   http://localhost:9090"
Write-Host "  Grafana:      http://localhost:3000 (user: admin, password: admin)"
Write-Host ""
Write-Host "üí° To stop services: cd infrastructure\docker; docker-compose down" -ForegroundColor Yellow
```

### run-migrations.sh Template

```bash
#!/bin/bash
set -e

# AI Budgeting Coach - Database Migrations Script
# This script will run EF Core migrations for all services

echo "üîÑ Running database migrations..."
echo ""

# TODO: Implement in future stories
# Example usage:
# cd services/UserService/UserService.Infrastructure
# dotnet ef database update --startup-project ../UserService.API

echo "‚ö†Ô∏è  Not yet implemented"
echo "This script will be populated when services are created"
echo ""
echo "Manual migration for now:"
echo "  cd services/[ServiceName]/[ServiceName].Infrastructure"
echo "  dotnet ef database update --startup-project ../[ServiceName].API"
```

### seed-data.sh Template

```bash
#!/bin/bash
set -e

# AI Budgeting Coach - Test Data Seeding Script
# This script will seed test data for local development

echo "üå± Seeding test data..."
echo ""

# TODO: Implement in future stories
# Example usage:
# psql -h localhost -U budgetcoach -d user_db -f test-data/users.sql

echo "‚ö†Ô∏è  Not yet implemented"
echo "This script will be populated when services are created"
echo ""
echo "Manual seeding for now:"
echo "  psql -h localhost -U budgetcoach -d [database_name]"
echo "  Then run INSERT statements manually"
```

### scripts/README.md Template

```markdown
# Development Scripts

Utility scripts to simplify common development tasks.

## Prerequisites

- Docker Desktop installed and running
- Bash shell (macOS/Linux) or PowerShell (Windows)
- .NET 8 SDK (for migration scripts)
- PostgreSQL client (for data seeding)

## Available Scripts

### setup-dev.sh / setup-dev.ps1

Starts the development infrastructure (PostgreSQL, RabbitMQ, Prometheus, Grafana).

**Usage (Linux/macOS):**
```bash
./infrastructure/scripts/setup-dev.sh
```

**Usage (Windows):**
```powershell
.\infrastructure\scripts\setup-dev.ps1
```

**What it does:**
1. Checks if Docker is running
2. Starts all Docker Compose services
3. Waits for services to be healthy
4. Displays service status and access URLs

### run-migrations.sh

Runs Entity Framework Core migrations for all services.

**Status:** Placeholder (will be implemented in service stories)

**Future Usage:**
```bash
./infrastructure/scripts/run-migrations.sh
```

### seed-data.sh

Seeds test data into databases for local development.

**Status:** Placeholder (will be implemented in service stories)

**Future Usage:**
```bash
./infrastructure/scripts/seed-data.sh
```

## Troubleshooting

### Docker not running
**Error:** `Docker is not running`
**Solution:** Start Docker Desktop and wait for it to fully initialize

### Port conflicts
**Error:** `port is already allocated`
**Solution:** Stop any services using ports 5432, 5672, 15672, 9090, 3000
```bash
# Check what's using a port (Linux/macOS)
lsof -i :5432

# Check what's using a port (Windows)
netstat -ano | findstr :5432
```

### Services unhealthy
**Error:** Services show as unhealthy in `docker-compose ps`
**Solution:** Check logs for specific service
```bash
cd infrastructure/docker
docker-compose logs [service-name]
```

## Common Commands

```bash
# Start services
./infrastructure/scripts/setup-dev.sh

# Stop services
cd infrastructure/docker && docker-compose down

# Stop and remove volumes (fresh start)
cd infrastructure/docker && docker-compose down -v

# View logs
cd infrastructure/docker && docker-compose logs -f

# Check service status
cd infrastructure/docker && docker-compose ps
```
```

### Script Permissions

On Linux/macOS, scripts must be executable:
```bash
chmod +x infrastructure/scripts/setup-dev.sh
chmod +x infrastructure/scripts/run-migrations.sh
chmod +x infrastructure/scripts/seed-data.sh
```

### Testing

#### Testing Standards

**Test Location:** Manual execution - verify scripts work as expected

**Testing Checklist:**

**Linux/macOS:**
```bash
# Test setup-dev.sh
./infrastructure/scripts/setup-dev.sh
# Should start all services and display URLs

# Test error handling
# 1. Stop Docker Desktop
./infrastructure/scripts/setup-dev.sh
# Should display error about Docker not running

# Test placeholders
./infrastructure/scripts/run-migrations.sh
./infrastructure/scripts/seed-data.sh
# Should display "Not yet implemented" messages
```

**Windows:**
```powershell
# Test setup-dev.ps1
.\infrastructure\scripts\setup-dev.ps1
# Should start all services and display URLs

# Test error handling
# 1. Stop Docker Desktop
.\infrastructure\scripts\setup-dev.ps1
# Should display error about Docker not running
```

**Verification:**
- ‚úÖ Scripts execute without syntax errors
- ‚úÖ Error messages are clear and helpful
- ‚úÖ Service URLs are displayed correctly
- ‚úÖ Scripts exit with proper error codes
- ‚úÖ Scripts work from any directory

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-06 | 1.0 | Initial story creation from epic | Winston (Architect) |

---

## Dev Agent Record

### Agent Model Used

_[To be filled by dev agent]_

### Debug Log References

_[To be filled by dev agent]_

### Completion Notes List

_[To be filled by dev agent]_

### File List

_[To be filled by dev agent]_

---

## QA Results

_[To be filled by QA agent after implementation]_
